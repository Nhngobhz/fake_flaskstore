{% extends "admin/base.html" %}

{% macro display_categories(categories, level=0) %}
    <ul class="list-unstyled">
    {% for cat in categories %}
        <li class="category-item" style="--indent: {{ 20 + level * 20 }}px;">
            <div class="d-flex justify-content-between align-items-center p-3 border rounded bg-light">
                <span>
                    {% for _ in range(level) %}<i class="bi bi-arrow-return-right text-muted"></i> {% endfor %}
                    <i class="bi bi-tag-fill text-primary"></i>
                    <strong>{{ cat.name }}</strong> (ID: {{ cat.id }})
                </span>
                <div>
                    <a href="{{ url_for('edit_category', id=cat.id) }}" class="btn btn-sm btn-outline-primary me-1"><i class="bi bi-pencil"></i> Edit</a>
                    <form method="POST" action="{{ url_for('delete_category', id=cat.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this category?')"><i class="bi bi-trash"></i> Delete</button>
                    </form>
                </div>
            </div>
            {% if cat.children %}
                {{ display_categories(cat.children, level + 1) }}
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% endmacro %}

{% block content %}
    <h2 class="mb-4"><i class="bi bi-tags"></i> Categories Hierarchy</h2>
    <a href="{{ url_for('add_category') }}" class="btn btn-dark mb-3"><i class="bi bi-plus-circle"></i> Add Category</a>

    {% if top_level_categories %}
        {{ display_categories(top_level_categories) }}
    {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No categories found. <a href="{{ url_for('add_category') }}">Add your first category</a>.
        </div>
    {% endif %}

{% endblock %}